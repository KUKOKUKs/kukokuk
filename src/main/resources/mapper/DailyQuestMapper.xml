<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kukokuk.mapper.DailyQuestMapper">

    <!--
         * 모든 퀘스트 정보 목록 조회
         * @return 모든 퀘스트 정보 목록
        List<DailyQuestStatusResponse> getDailyQuests();
    -->
    <select id="getDailyQuests" resultType="DailyQuest">
        SELECT
            DAILY_QUEST_NO          AS dailyQuestNo
             , CONTENT_TYPE         AS contentType
             , CONTENT_TEXT         AS contentText
             , POINT                AS point
             , COUNT                AS count
        FROM KUKOKUK_DAILY_QUESTS
        ORDER BY DAILY_QUEST_NO
    </select>

    <!--
         * 사용자 번호로 오늘에 대한 경험치, 횟수 집계(content_type 기준)
         * @param userNo 사용자 정보
         * @return 오늘 경험치, 횟수 집계
        List<DailyQuestProgressAggDto> getDailyQuestProgressAggByUserNo(int userNo);
    -->
    <select id="getDailyQuestProgressAggByUserNo" resultType="DailyQuestProgressAggDto">
        SELECT
            CONTENT_TYPE            AS contentType
             , SUM(EXP_GAINED)      AS expSum
             , COUNT(*)             AS cnt
        FROM KUKOKUK_EXP_LOGS
        WHERE USER_NO = #{userNo}
            AND CREATED_DATE &gt;= CURDATE()
            AND CREATED_DATE &lt;  CURDATE() + INTERVAL 1 DAY
        GROUP BY CONTENT_TYPE
    </select>

    <!--
         * 사용자의 일일도전과제 완료된 목록 조회
         * @param userNo 사용자 번호
         * @return 사용자의 일일도전과제 완료된 목록
        List<DailyQuestUser> getDailyQuestUserByUserNo(int userNo);
    -->
    <select id="getDailyQuestUserByUserNo" resultType="DailyQuestUser">
        SELECT
            DAILY_QUEST_USER_NO         AS dailyQuestUserNo
             , DAILY_QUEST_NO           AS dailyQuestNo
             , USER_NO                  AS userNo
             , IS_OBTAINED              AS isObtained
             , CREATED_DATE             AS createdDate
        FROM KUKOKUK_DAILY_QUEST_USERS
        WHERE USER_NO = #{userNo}
            AND IS_OBTAINED = 'Y'
            AND CREATED_DATE &gt;= CURDATE()
            AND CREATED_DATE &lt;  CURDATE() + INTERVAL 1 DAY
        ORDER BY DAILY_QUEST_USER_NO
    </select>

    <!--삭제 예정-->
    <resultMap id="DailyQuestResultMap" type="DailyQuest">
        <id property="dailyQuestNo" column="DAILY_QUEST_NO"/>
        <result property="contentType" column="CONTENT_TYPE"/>
        <result property="contentText" column="CONTENT_TEXT"/>
    </resultMap>
    <select id="getDailyQuestByContentType" resultMap="DailyQuestResultMap">
        SELECT DAILY_QUEST_NO,
               CONTENT_TYPE,
               CONTENT_TEXT
        FROM KUKOKUK_DAILY_QUESTS
        WHERE CONTENT_TYPE = #{contentType}
    </select>

</mapper>
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kukokuk.repository.DailyQuestMapper">

  <!--
    List<DailyQuest> getDailyQuestByContentType(String contentType);
  -->
  <resultMap id="DailyQuestResultMap" type="DailyQuest">
    <id property="dailyQuestNo" column="DAILY_QUEST_NO"/>
    <result property="contentType" column="CONTENT_TYPE"/>
    <result property="contentText" column="CONTENT_TEXT"/>
  </resultMap>
  <select id="getDailyQuestByContentType" resultMap="DailyQuestResultMap">
    SELECT
      DAILY_QUEST_NO,
      CONTENT_TYPE,
      CONTENT_TEXT
    FROM
      KUKOKUK_DAILY_QUESTS
    WHERE
      CONTENT_TYPE = #{contentType}
  </select>
  
  <!--
    List<DailyQuestUser> getDailyQuestUserByUserNo(@Param("userNo") int userNo,
          @Param("condition") Map<String, Object> condition);
  -->
  <resultMap id="DailyQuestUserResultMap" type="DailyQuestUser">
    <id property="dailyQuestUserNo" column="DAILY_QUEST_USER_NO"/>
    <result property="dailyQuestNo" column="DAILY_QUEST_NO"/>
    <result property="userNo" column="USER_NO"/>
    <result property="isObtained" column="IS_OBTAINED"/>
    <result property="createdDate" column="CREATED_DATE"/>
  </resultMap>
  <select id="getDailyQuestUserByUserNo" resultMap="DailyQuestUserResultMap">
    SELECT
        U.DAILY_QUEST_USER_NO,
        U.DAILY_QUEST_NO,
        U.IS_OBTAINED,
        U.CREATED_DATE,
        U.USER_NO
    FROM
        KUKOKUK_DAILY_QUEST_USERS U
        JOIN KUKOKUK_DAILY_QUESTS Q
            ON U.DAILT_QUEST_NO = Q.DAILT_QUEST_NO
    WHERE
        U.USER_NO = #{userNo}
        <if test="condition.contentType != null">
          AND Q.CONTENT_TYPE = #{condition.contentType}
        </if>
        <if test="condition.completedDate != null">
          AND DATE(U.CREATED_DATE) = DATE(#{condition.completedDate})
        </if>
  </select>
</mapper>
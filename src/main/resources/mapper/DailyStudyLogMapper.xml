<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kukokuk.mapper.DailyStudyLogMapper">
    <!--
        public List<DailyStudyLog> getStudyLogsByUserNo(@Param("userNo") int userNo,
        @Param("condition") Map<String, Object> condition);
    -->
    <resultMap id="DailyStudyLogResultMap" type="DailyStudyLog">
    <id column="DAILY_STUDY_LOG_NO" property="dailyStudyLogNo"/>
    <result column="USER_NO" property="userNo"/>
    <result column="DAILY_STUDY_NO" property="dailyStudyNo"/>
    <result column="STUDIED_CARD_COUNT" property="studiedCardCount"/>
    <result column="COMPLETED_DATE" property="completedDate"/>
    <result column="STATUS" property="status"/>
    <result column="CREATED_DATE" property="createdDate"/>
    <result column="UPDATED_DATE" property="updatedDate"/>
</resultMap>

    <select id="getStudyLogsByUserNo" resultMap="DailyStudyLogResultMap">
        SELECT
            DAILY_STUDY_LOG_NO,
            USER_NO,
            DAILY_STUDY_NO,
            STUDIED_CARD_COUNT,
            COMPLETED_DATE,
            STATUS,
            CREATED_DATE,
            UPDATED_DATE
        FROM
            KUKOKUK_DAILY_STUDY_LOGS
        WHERE
            USER_NO = #{userNo}
        <if test="condition.status != null">
            <choose>
                <when test="condition.status == 'inProgress'">
                    AND STATUS = 'IN_PROGRESS'
                </when>
                <when test="condition.status == 'completed'">
                    AND STATUS = 'COMPLETED'
                </when>
            </choose>
        </if>

        <if test="condition.order != null">
            <choose>
                <when test="condition.order == 'updatedDate'">
                    ORDER BY
                        UPDATED_DATE
                </when>
            </choose>
        </if>

        <if test="condition.rows != null">
            <choose>
                <when test="condition.offset != null">
                    LIMIT #{condition.offset}, #{condition.rows}
                </when>
                <otherwise>
                    LIMIT 0, #{condition.rows}
                </otherwise>
            </choose>
        </if>
    </select>

    <!--
    DailyStudyLog getStudyLogsByUserNoAndDailyStudyNo(@Param("userNo") int userNo, @Param("dailyStudyNo") int dailyStudyNo);
    -->
    <select id="getStudyLogsByUserNoAndDailyStudyNo" resultMap="DailyStudyLogResultMap">
        SELECT
            DAILY_STUDY_LOG_NO,
            USER_NO,
            DAILY_STUDY_NO,
            STUDIED_CARD_COUNT,
            COMPLETED_DATE,
            STATUS,
            CREATED_DATE,
            UPDATED_DATE
        FROM
            KUKOKUK_DAILY_STUDY_LOGS
        WHERE
            USER_NO = #{userNo}
            AND DAILY_STUDY_NO = #{dailyStudyNo}
    </select>

</mapper>
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kukokuk.mapper.DailyStudyMaterialMapper">

  <!--
   void insertStudyMaterial(DailyStudyMaterial dailyStudyMaterial);
  -->
  <insert id="insertStudyMaterial" parameterType="DailyStudyMaterial">
    <selectKey resultType="int" keyProperty="sequence" order="BEFORE">
      SELECT
        IFNULL(MAX(SEQUENCE), 0) + 1
      FROM
         KUKOKUK_DAILY_STUDY_MATERIALS
      WHERE
        SCHOOL = #{school}
        AND GRADE = #{grade}
    </selectKey>
    INSERT INTO
        KUKOKUK_DAILY_STUDY_MATERIALS
        (SCHOOL, GRADE, MATERIAL_TITLE, KEYWORDS, CONTENT, SOURCE_FILENAME, SEQUENCE)
    VALUES
      (
       #{school},
       #{grade},
       #{materialTitle},
       #{keywords},
       #{content},
       #{sourceFilename},
       #{sequence}
      )
  </insert>
  
  <!-- 
  int getMaxSequenceBySchoolAndGrade(String school, int grade);
  -->
  <select id="getMaxSequenceBySchoolAndGrade" resultType="int">
    SELECT
        MAX(SEQUENCE)
    FROM
      KUKOKUK_DAILY_STUDY_MATERIALS
    WHERE
        SCHOOL = #{school}
        AND GRADE = #{grade}
  </select>
</mapper>
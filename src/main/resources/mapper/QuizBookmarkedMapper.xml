<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kukokuk.mapper.QuizBookmarkedMapper">

    <resultMap id="QuizBookmarkedMap" type="QuizBookmarked">
        <id property="bookmarkNo" column="BOOKMARK_NO"/>
        <result property="userNo" column="USER_NO"/>
        <result property="quizNo" column="QUIZ_NO"/>
        <result property="createdDate" column="CREATED_DATE"/>
    </resultMap>

    <!--
        * 북마크 단건 조회(유저+퀴즈 기준)
        * @param userNo 사용자 번호
        * @param quizNo 퀴즈 번호
        * @return QuizBookmarked 객체 (없으면 null)
    -->
    <select id="getQuizBookmarkedByUserNoAndQuizNo" resultMap="QuizBookmarkedMap">
        SELECT BOOKMARK_NO, USER_NO, QUIZ_NO, CREATED_DATE
        FROM KUKOKUK_QUIZ_BOOKMARKED
        WHERE USER_NO = #{userNo}
          AND QUIZ_NO = #{quizNo}
    </select>

    <!--
        * 북마크 등록
        * @param quizBookmarked 북마크 객체
        * @return int (등록된 row 수)
    -->
    <insert id="insertQuizBookmarked" parameterType="QuizBookmarked">
        INSERT INTO KUKOKUK_QUIZ_BOOKMARKED
            (USER_NO, QUIZ_NO, CREATED_DATE)
        VALUES
            (#{userNo}, #{quizNo}, NOW())
    </insert>

    <!--
        * 북마크 삭제
        * @param userNo 사용자 번호
        * @param quizNo 퀴즈 번호
        * @return int (삭제된 row 수)
    -->
    <delete id="deleteQuizBookmarkedByUserNoAndQuizNo">
        DELETE FROM KUKOKUK_QUIZ_BOOKMARKED
        WHERE USER_NO = #{userNo}
          AND QUIZ_NO = #{quizNo}
    </delete>

    <!--
        * 해당 사용자의 전체 북마크 리스트 조회
        * @param userNo 사용자 번호
        * @return List<QuizBookmarked>
    -->
    <select id="getQuizBookmarkedListByUserNo" resultMap="QuizBookmarkedMap">
        SELECT BOOKMARK_NO, USER_NO, QUIZ_NO, CREATED_DATE
        FROM KUKOKUK_QUIZ_BOOKMARKED
        WHERE USER_NO = #{userNo}
        ORDER BY CREATED_DATE DESC
    </select>
</mapper>

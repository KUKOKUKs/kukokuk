<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kukokuk.mapper.QuizSessionSummaryMapper">

   <!--
    * 퀴즈 세션 요약 정보를 저장한다.
    * @param summary 저장할 퀴즈 세션 요약 객체
    * @return insert 성공 여부
    int insertQuizSessionSummary(QuizSessionSummary summary);
    -->
    <insert id="insertQuizSessionSummary" parameterType="QuizSessionSummary" useGeneratedKeys="true" keyProperty="sessionNo">
        INSERT INTO KUKOKUK_QUIZ_SESSION_SUMMARIES
        (
            TOTAL_TIME_SEC,
            TOTAL_QUESTION,
            CORRECT_ANSWERS,
            PERCENTILE,
            AVERAGE_TIME_PER_QUESTION,
            USER_NO
        )
        VALUES
            (
                #{totalTimeSec},
                #{totalQuestion},
                #{correctAnswers},
                #{percentile},
                #{averageTimePerQuestion},
                #{userNo}
            )
    </insert>
<!--
    * 세션 요약 정보를 수정한다 (정답 수, 평균 시간 드ㅇ)
    * @param summary 수정할 세션 정보
    * @return 수정된 행 수
    int updateQuizSessionSummary(QuizSessionSummary summary);
    -->
    <update id="updateQuizSessionSummary" parameterType="QuizSessionSummary">
        UPDATE KUKOKUK_QUIZ_SESSION_SUMMARIES
        SET CORRECT_ANSWERS = #{correctAnswers},
            AVERAGE_TIME_PER_QUESTION = #{averageTimePerQuestion}
        WHERE SESSION_NO = #{sessionNo}
    </update>
<!--
    * 세션 번호와 유저 번호로 퀴즈 세션 요약 정보를 조회한다.
    * 결과 화면에 표시할 요약 정보 조회 시 사용.
    *
    * @param sessionNo 세션 번호
    * @param userNo 유저 번호
    * @return 해당하는 세션 요약 정보, 없으면 null
    QuizSessionSummary getSummaryBySessionNoAndUserNo(@Param("sessionNo") int sessionNo,
    @Param("userNo") int userNo);
    -->
    <select id="getSummaryBySessionNoAndUserNo" resultType="QuizSessionSummary">
        SELECT *
        FROM KUKOKUK_QUIZ_SESSION_SUMMARIES
        WHERE SESSION_NO = #{sessionNo}
          AND USER_NO = #{userNo}
    </select>

</mapper>

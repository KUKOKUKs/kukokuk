<!DOCTYPE html>
<html layout:decorate="~{/layout/center}" th:with="title='ë°›ì•„ì“°ê¸°'">
<div layout:fragment="content">
    <div class="content center base_gap" style="display: flex; flex-direction: column; align-items: center; gap: 2rem; min-height: 100vh; padding: 2rem;">
        div.

        <!-- ë¬¸ì œ+ë²„íŠ¼ ë°•ìŠ¤ -->
        <div class="component box_shadow large_font"
             style="width: 100%; max-width: 600px; padding: 2rem; position: relative; display: flex; flex-direction: column;">

            <!-- ìƒë‹¨ ë°”: ë¬¸ì œ ë²ˆí˜¸ + ë²„íŠ¼ 2ê°œ -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
        <span style="font-size: var(--smallFontSize); color: var(--grayColor);">
          ë¬¸ì œ ë²ˆí˜¸: <span th:text="${index}">1</span>
        </span>

                <div style="display: flex; gap: 0.5rem;">
                    <button type="button"
                            class="btn small white"
                            th:attr="data-text=${question.correctAnswer}"
                            onclick="speakFromData(this)">
                        ğŸ”Š ë“£ê¸°
                    </button>

                    <button type="button" id="toggleAnswerBtn" class="btn small white" onclick="toggleAnswer()">
                        ì •ë‹µ ë³´ê¸°
                    </button>
                </div>
            </div>

            <!-- ë¬¸ì œ ë‚´ìš© (ìˆ¨ê¹€ ìƒíƒœ) -->
            <p id="answerText" th:text="'ì •ë‹µ: ' + ${question.correctAnswer}" style="display: none; text-align: center; margin-top: 1rem;"></p>
        </div>

        <!-- ì •ë‹µ ì…ë ¥ í¼ ë°•ìŠ¤ -->
        <form th:action="@{/dictation/submit-answer}" method="post" class="component box_shadow"
              style="width: 100%; max-width: 600px; padding: 2rem;">
            <input type="hidden" th:name="index" th:value="${index}" />

            <div class="d_flex justify_content_between align_end" style="gap: 1rem;">
                <div style="flex: 1;">
                    <input type="text"
                           name="userAnswer"
                           placeholder="ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”"
                           th:value="${answer}"
                           class="input_info one_input"
                           style="font-size: var(--largeFontSize); padding: 1rem; border: var(--thinBorder); border-radius: var(--bdrs);" />
                </div>
                <div>
                    <button type="submit" class="btn primary large_font" style="padding: 0.75rem 1.5rem;">ì œì¶œ</button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- ğŸ“¢ ìŒì„± ìŠ¤í¬ë¦½íŠ¸ -->
<th:block layout:fragment="script">
    <script>
      function speakFromData(btn) {
        const text = btn.getAttribute("data-text");
        if (!text) {
          console.warn("ì½ì„ í…ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.");
          return;
        }
        console.log("ìŒì„±ìœ¼ë¡œ ì½ì„ ë¬¸ì¥:", text);
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'ko-KR';
        speechSynthesis.cancel();
        speechSynthesis.speak(utterance);
      }
    </script>

    <script>
      function toggleAnswer() {
        const answerElem = document.getElementById("answerText");
        const btn = document.getElementById("toggleAnswerBtn");
        if (answerElem.style.display === "none") {
          answerElem.style.display = "block";
          btn.textContent = "ì •ë‹µ ìˆ¨ê¸°ê¸°";
        } else {
          answerElem.style.display = "none";
          btn.textContent = "ì •ë‹µ ë³´ê¸°";
        }
      }
    </script>

</th:block>

</body>
</html>

<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{layout/base}">
<head>
    <title>그룹 랭킹 - KUKOKUK</title>
</head>

<th:block layout:fragment="content">
    <div class="content_info">
        <!-- 페이지 헤더 -->
        <div class="content_title">
            <iconify-icon icon="fluent-color:people-team-24"></iconify-icon>
            <span th:text="${contentTypeName + ' 그룹 랭킹'}">스피드퀴즈 그룹 랭킹</span>
            <div class="content_sub_title">
                우리 그룹의 <span th:text="${rankMonth}">2025-01</span> 월간 랭킹
            </div>
        </div>

        <!-- 네비게이션 -->
        <div class="group_ranking_nav">
            <div class="component">
                <div class="nav_links">
                    <a th:href="@{/ranking(contentType=${contentType}, rankMonth=${rankMonth})}"
                       class="nav_btn back_btn">
                        <iconify-icon icon="fluent:arrow-left-24-filled"></iconify-icon>
                        전체 랭킹으로
                    </a>
                    <a th:href="@{/group}" class="nav_btn group_btn">
                        <iconify-icon icon="fluent-color:home-24"></iconify-icon>
                        그룹 홈
                    </a>
                </div>
            </div>
        </div>

        <!-- 컨트롤 영역 -->
        <div class="ranking_controls">
            <!-- 컨텐츠 타입 선택 -->
            <div class="component">
                <div class="component_title">
                    <iconify-icon icon="fluent-color:games-24"></iconify-icon>
                    게임 종류
                </div>
                <div class="content_type_selector">
                    <a th:href="@{/ranking/group(groupNo=${groupNo}, contentType='SPEED', rankMonth=${rankMonth})}"
                       class="content_type_btn"
                       th:classappend="${contentType == 'SPEED'} ? 'active' : ''">
                        <iconify-icon icon="flat-color-icons:flash-on"></iconify-icon>
                        스피드퀴즈
                    </a>
                    <a th:href="@{/ranking/group(groupNo=${groupNo}, contentType='LEVEL', rankMonth=${rankMonth})}"
                       class="content_type_btn"
                       th:classappend="${contentType == 'LEVEL'} ? 'active' : ''">
                        <iconify-icon icon="flat-color-icons:graduation-cap"></iconify-icon>
                        단계별 퀴즈
                    </a>
                    <a th:href="@{/ranking/group(groupNo=${groupNo}, contentType='DICTATION', rankMonth=${rankMonth})}"
                       class="content_type_btn"
                       th:classappend="${contentType == 'DICTATION'} ? 'active' : ''">
                        <iconify-icon icon="flat-color-icons:edit"></iconify-icon>
                        받아쓰기
                    </a>
                </div>
            </div>

            <!-- 월 선택 -->
            <div class="component">
                <div class="component_title">
                    <iconify-icon icon="fluent-color:calendar-24"></iconify-icon>
                    조회 월
                </div>
                <div class="month_selector">
                    <a th:if="${prevMonth != null}"
                       th:href="@{/ranking/group(groupNo=${groupNo}, contentType=${contentType}, rankMonth=${prevMonth})}"
                       class="month_nav_btn">
                        <iconify-icon icon="fluent:arrow-left-24-filled"></iconify-icon>
                        <span th:text="${prevMonth}">2024-12</span>
                    </a>

                    <div class="current_month">
                        <span th:text="${rankMonth}">2025-01</span>
                        <span th:if="${isCurrentMonth}" class="current_badge">현재</span>
                    </div>

                    <a th:if="${nextMonth != null}"
                       th:href="@{/ranking/group(groupNo=${groupNo}, contentType=${contentType}, rankMonth=${nextMonth})}"
                       class="month_nav_btn">
                        <span th:text="${nextMonth}">2025-02</span>
                        <iconify-icon icon="fluent:arrow-right-24-filled"></iconify-icon>
                    </a>
                </div>
            </div>
        </div>

        <!-- 내 그룹 순위 정보 -->
        <div th:if="${myGroupRanking != null}" class="my_group_ranking_section">
            <div class="component my_group_ranking_card">
                <div class="component_title">
                    <iconify-icon icon="fluent-color:star-24"></iconify-icon>
                    우리 그룹에서 내 순위
                </div>
                <div class="my_group_ranking_content">
                    <div class="group_rank_display">
                        <div class="rank_circle">
                            <span class="rank_number" th:text="${myGroupRanking}">3</span>
                            <span class="rank_suffix">위</span>
                        </div>
                        <div class="rank_message">
                            <span th:if="${myGroupRanking == 1}" class="crown">👑</span>
                            <span th:if="${myGroupRanking <= 3}" class="top_message">상위권 진입!</span>
                            <span th:unless="${myGroupRanking <= 3}" class="encourage_message">더 높은 순위 도전!</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 그룹 랭킹 리스트 -->
        <div class="group_ranking_section">
            <div class="component">
                <div class="component_title">
                    <iconify-icon icon="fluent-color:people-team-24"></iconify-icon>
                    그룹 랭킹
                    <div class="ranking_count">
                        참여 인원 <span th:text="${#lists.size(groupRankings)}">15</span>명
                    </div>
                </div>

                <div class="ranking_table_container">
                    <div th:if="${!#lists.isEmpty(groupRankings)}" class="ranking_table group_table">
                        <!-- 테이블 헤더 -->
                        <div class="ranking_row header">
                            <div class="rank_col">순위</div>
                            <div class="user_col">그룹원</div>
                            <div class="score_col">평균점수</div>
                            <div class="play_col">횟수</div>
                            <div class="status_col">상태</div>
                        </div>

                        <!-- 랭킹 데이터 -->
                        <div th:each="ranking, stat : ${groupRankings}"
                             class="ranking_row data group_row"
                             th:classappend="${stat.index < 3} ? 'top-' + (${stat.index + 1}) : ''"
                             th:data-user-no="${ranking.userNo}">

                            <div class="rank_col">
                                <span th:if="${stat.index == 0}" class="medal gold">🥇</span>
                                <span th:if="${stat.index == 1}" class="medal silver">🥈</span>
                                <span th:if="${stat.index == 2}" class="medal bronze">🥉</span>
                                <span th:if="${stat.index > 2}" class="rank_number" th:text="${stat.index + 1}">4</span>
                            </div>

                            <div class="user_col">
                                <div class="user_profile">
                                    <div class="profile_image">
                                        <img th:if="${ranking.profileFilename != null}"
                                             th:src="@{'/images/profile/' + ${ranking.profileFilename}}"
                                             th:alt="${ranking.nickname}" />
                                        <iconify-icon th:unless="${ranking.profileFilename != null}"
                                                      icon="iconamoon:profile-circle-fill"></iconify-icon>
                                    </div>
                                    <span class="nickname" th:text="${ranking.nickname}">닉네임</span>
                                </div>
                            </div>

                            <div class="score_col">
                                <span class="score_value" th:text="${#numbers.formatDecimal(ranking.totalScore, 0, 1)}">85.5</span>
                                <span class="score_unit">점</span>
                            </div>

                            <div class="play_col">
                                <span class="play_count" th:text="${ranking.playCount}">15</span>
                                <span class="play_unit">회</span>
                            </div>

                            <div class="status_col">
                                <span th:if="${stat.index == 0}" class="status_badge leader">그룹 1위</span>
                                <span th:if="${stat.index > 0 && stat.index < 3}" class="status_badge top">상위권</span>
                                <span th:if="${stat.index >= 3 && stat.index < 10}" class="status_badge middle">중위권</span>
                                <span th:if="${stat.index >= 10}" class="status_badge lower">하위권</span>
                            </div>
                        </div>
                    </div>

                    <!-- 랭킹 데이터가 없을 경우 -->
                    <div th:if="${#lists.isEmpty(groupRankings)}" class="no_ranking_data">
                        <iconify-icon icon="fluent-color:people-team-off-24"></iconify-icon>
                        <p>아직 그룹 랭킹 데이터가 없습니다.</p>
                        <p class="sub_text">그룹원들이 게임을 플레이하면 랭킹이 생성됩니다!</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 그룹 랭킹 특별 기능 -->
        <div class="group_features_section">
            <div class="grid_list_component" style="--cols: 2;">
                <!-- 그룹 챌린지 -->
                <div class="component grid_list feature_card">
                    <div class="component_title">
                        <iconify-icon icon="fluent-color:target-24"></iconify-icon>
                        그룹 챌린지
                    </div>
                    <div class="feature_content">
                        <p>그룹 평균 점수를 높여 다른 그룹과 경쟁해보세요!</p>
                        <div class="challenge_progress">
                            <div class="progress_info">
                                <span>이번 달 그룹 평균</span>
                                <span class="progress_score">78.5점</span>
                            </div>
                            <div class="bar_gauge">
                                <div class="gauge" style="width: 78.5%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 그룹 통계 -->
                <div class="component grid_list feature_card">
                    <div class="component_title">
                        <iconify-icon icon="fluent-color:chart-multiple-24"></iconify-icon>
                        그룹 통계
                    </div>
                    <div class="feature_content">
                        <div class="stat_grid">
                            <div class="stat_item">
                                <span class="stat_label">총 참여자</span>
                                <span class="stat_value" th:text="${#lists.size(groupRankings)} + '명'">15명</span>
                            </div>
                            <div class="stat_item">
                                <span class="stat_label">평균 플레이 횟수</span>
                                <span class="stat_value">8.2회</span>
                            </div>
                            <div class="stat_item">
                                <span class="stat_label">최고 점수</span>
                                <span class="stat_value"
                                      th:text="${!#lists.isEmpty(groupRankings) ? #numbers.formatDecimal(groupRankings[0].totalScore, 0, 1) + '점' : '0점'}">92.3점</span>
                            </div>
                            <div class="stat_item">
                                <span class="stat_label">그룹 순위</span>
                                <span class="stat_value">전체 5위</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 그룹 응원 메시지 -->
        <div class="group_cheer_section">
            <div class="component cheer_card">
                <div class="cheer_content">
                    <iconify-icon icon="fluent-color:heart-24"></iconify-icon>
                    <div class="cheer_text">
                        <h3>함께 성장하는 우리 그룹!</h3>
                        <p>그룹원들과 함께 더 높은 점수에 도전해보세요. 서로 응원하며 실력을 키워나가요!</p>
                    </div>
                    <div class="cheer_actions">
                        <a th:href="@{/quiz/speed}" class="cheer_btn primary">
                            <iconify-icon icon="flat-color-icons:flash-on"></iconify-icon>
                            지금 플레이하기
                        </a>
                        <a th:href="@{/group}" class="cheer_btn secondary">
                            <iconify-icon icon="fluent-color:people-team-24"></iconify-icon>
                            그룹 홈으로
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</th:block>

<th:block layout:fragment="script">
    <script th:src="@{/js/modules/ranking/ranking-group.js}"></script>
</th:block>
</html>
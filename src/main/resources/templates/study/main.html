<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/layout/base}" th:with="menu='study'">
<!--

-->
<div layout:fragment="content">
    <!--  <button type="button" id="hint-item-btn" data-daily-quest-user-no="${}">힌트 획득</button>-->

    <div id="main-content" class="main_container">
        <div class="content_title"> 일일학습 목록</div>
        <div class="study_list_container">
            <!-- 일일학습 카드가 동적으로 추가되는 부분 -->
        </div>
    </div>

    <!-- 서브콘텐츠 -->
    <div id="sub-content" class="main_container">
        <!-- 사용자 프로필 컴포넌트 -->
        <th:block th:replace="~{fragments/common/profile :: profile-fragment}"></th:block>

        <!-- 도전과제 리스트 컴포넌트 -->
        <div class="component" id="daily-quest-list">
            <div class="component_list_container">
                <div class="component_title">
                    도전과제
                </div>
                <div class="component_list">
                    <div class="daily_quest_item" th:each="quest : ${data.dailyQuestDtos}">
                        <span th:text="${quest.getContentText()}">오늘의 일일학습 완료하기</span>
                        <div class="hint-btn-container">
                            <!-- 사용자의 도전과제 수행 이력이 존재하지 않는 경우  -->
                            <th:block th:if="${!quest.isSuccessed()}">
                                <button class="hint_icon_btn deactive disabled">
                                    <img th:src="@{/images/favicon-32x32.png/}" alt="hints">
                                </button>
                            </th:block>
                            <!-- 사용자의 도전과제 수행 이력이 존재하는 경우  -->
                            <th:block th:if="${quest.isSuccessed()}">
                                <!-- 사용자가 아이템을 획득하기 전일 경우 -->
                                <th:block th:if="${quest.dailyQuestUser.isObtained == 'N'}">
                                    <button class="hint_icon_btn active"
                                            th:attr="data-quest-user-no=${quest.dailyQuestUser.dailyQuestUserNo}">
                                        <img th:src="@{/images/favicon-32x32.png/}" alt="hints">
                                    </button>
                                </th:block>
                                <!-- 사용자가 아이템을 획득한 후일 경우 -->
                                <th:block th:if="${quest.dailyQuestUser.isObtained == 'Y'}">
                                    <div class="hint_obtained_icon">
                                        <!-- 획득완료 아이콘으로 변경 -->
                                        <iconify-icon icon="mingcute:check-fill"></iconify-icon>
                                    </div>
                                </th:block>
                            </th:block>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 학습이력 리스트 컴포넌트 -->
        <div class="component" id="study-history-list">
            <div class="component_list_container">
                <div class="component_title">
                    학습 히스토리
                </div>
                <div class="component_list">
                    <div class="study_history_item" th:each="log : ${data.getDailyStudyLogs()}">
                        <div th:text="${log.dailyStudy.title}">일일학습 제목</div>
                        <div class="history_info"
                             th:classappend="${log.status == 'COMPLETED'} ? 'completed' : 'in_progress'">
                            <!-- in_progress, completed -->
                            <span
                                th:text="${log.status == 'COMPLETED'} ? '학습완료' : '학습중'">학습 상태</span>
                            <!-- COMPLETED 상태일 경우 -->
                            <span th:if="${log.status == 'COMPLETED'}"
                                  th:text="'(' + ${#dates.format(log.updatedDate, 'yyyy/MM/dd')} + ')'">
              </span>
                            <!-- IN_PROGRESS 상태 -->
                            <span th:if="${log.status == 'IN_PROGRESS'}"
                                  th:text="'(' + ${#dates.format(log.updatedDate, 'yyyy/MM/dd')} + ' ~)'">
              </span>
                            <span class="icon_btn small">
                <iconify-icon icon="ep:arrow-right-bold"></iconify-icon>
              </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>


    <th:block layout:fragment="script">
        <script th:inline="javascript">
            // 사용자 인증정보로 부터 학습수준/진도를 객체로 저장, JS 에서 활용
            const userInfo = {
                difficulty: [[${#authentication?.principal?.user?.studyDifficulty}]],
                school: [[${#authentication?.principal?.user?.currentSchool}]],
                grade: [[${#authentication?.principal?.user?.currentGrade}]]
            };
        </script>
        <script type="module" th:src="@{/js/modules/study/study-home.js}"></script>
    </th:block>
</div>
</html>
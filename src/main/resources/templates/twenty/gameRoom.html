<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>스무고개 게임방</title>
    <link href="https://fonts.googleapis.com/css2?family=Jua&family=Nanum+Gothic:wght@400;700&display=swap" rel="stylesheet">

    <style>
      :root {
        --brand: #b8000d;
        --gray-100: #f7f8fa;
        --gray-200: #f0f0f0;
        --gray-300: #e5e7eb;
        --gray-500: #999;
        --text: #222;
        --blue: #007bff;
        --red: #f44336;
        --green: #4caf50;
        --yellow: #ffc107;
      }

      body {
        margin: 0;
        font-family: 'Nanum Gothic', sans-serif;
        background: linear-gradient(135deg, #fff8f0, #f0f7ff);
        color: var(--text);
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      .page_container {
        flex: 1;
        display: flex;
        flex-direction: column;
        height: 100%;
        padding: 12px 24px;
        gap: 12px;
      }

      .page_header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 20px;
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        font-weight: bold;
      }

      .user_info {
        font-size: 0.9rem;
        color: var(--gray-500);
      }

      /* ✅ 화면 폭 확장 + 채팅창 비율 확대 */
      .room_container {
        flex: 1;
        display: grid;
        grid-template-columns: 3fr 1fr;
        gap: 20px;
        width: 100%;
        height: 82vh;
      }

      /* ======================
         왼쪽 패널 (채팅)
      ======================= */
      .left_panel {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        height: 100%;
        background: #ffffffcc;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        backdrop-filter: blur(6px);
      }

      #board-area {
        flex: 1;
        border-radius: 12px;
        background: #fdfdfd;
        padding: 16px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 10px;
        box-shadow: inset 0 0 5px rgba(0,0,0,0.05);
        min-height: 350px;
        max-height: 540px;
      }

      .system_message {
        text-align: center;
        color: #888;
        font-style: italic;
        font-size: 0.9rem;
        padding: 4px;
      }

      .message-line {
        display: flex;
        flex-direction: column;
        max-width: 75%;
        padding: 6px;
        word-break: break-word;
        animation: fadeIn 0.3s ease;
      }

      @keyframes fadeIn {
        from {opacity: 0; transform: translateY(5px);}
        to {opacity: 1; transform: translateY(0);}
      }

      .my-message { align-self: flex-end; }
      .other-message { align-self: flex-start; }

      .message-bubble {
        padding: 8px 12px;
        border-radius: 10px;
        line-height: 1.5;
        font-size: 0.95rem;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      }

      .question-bubble {
        background-color: #d8ecff;
        border-left: 4px solid var(--blue);
      }

      .answer-bubble {
        background-color: #ffe3e3;
        border-left: 4px solid var(--red);
      }

      .normal-bubble {
        background-color: #f1f1f1;
        border-left: 4px solid #ccc;
      }

      .sender {
        font-weight: bold;
        font-size: 0.85rem;
        color: #555;
        margin-bottom: 4px;
      }

      /* ======================
         교사 버튼
      ======================= */
      .button_row {
        display: flex;
        gap: 10px;
        justify-content: space-between;
        margin-top: 10px;
      }

      .big_button {
        flex: 1;
        height: 60px;
        border: none;
        border-radius: 10px;
        font-size: 1.1rem;
        font-weight: bold;
        color: white;
        cursor: pointer;
        transition: all 0.2s ease;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      }

      #teacher-o-btn { background: var(--green); }
      #teacher-x-btn { background: var(--red); }
      #teacher-end-btn { background: #9c27b0; }
      #teacher-start-btn { background: var(--blue); }

      .big_button:disabled {
        background: #dcdcdc !important;
        color: #999 !important;
        cursor: not-allowed;
        opacity: 0.6;
        box-shadow: none;
      }

      /* ======================
         학생 입력
      ======================= */
      .student_controls {
        margin-top: 16px;
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 12px;
      }

      .input_group {
        display: flex;
        align-items: center;
        background: #fff;
        border-radius: 8px;
        padding: 6px 10px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      }

      .input_label {
        font-weight: 700;
        margin-right: 8px;
        color: #555;
      }

      .text_input {
        flex: 1;
        border: none;
        font-size: 1rem;
        outline: none;
        padding: 6px;
      }

      .arrow_button {
        border: none;
        background: #007bff;
        color: #fff;
        border-radius: 50%;
        width: 36px;
        height: 36px;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .raise_button {
        border: none;
        background: var(--yellow);
        color: #333;
        border-radius: 8px;
        font-weight: bold;
        font-size: 1rem;
        cursor: pointer;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        transition: all 0.2s ease;
      }

      /* ======================
         참여자 명단
      ======================= */
      .participants_panel {
        display: flex;
        flex-direction: column;
        background: #ffffffcc;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        backdrop-filter: blur(6px);
        height: 82vh;
      }

      .participants_header {
        font-weight: bold;
        text-align: center;
        font-size: 1.1rem;
        color: #4b0082;
        margin-bottom: 10px;
      }

      .participants_list {
        flex: 1;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 6px;
        background: #fafafa;
        border-radius: 8px;
        padding: 10px;
        scrollbar-width: thin;
      }

      .participants_user,
      .participants_user-join {
        padding: 8px;
        border-radius: 8px;
        text-align: center;
        font-size: 0.9rem;
      }

      .participants_user {
        color: gray;
        background: #f5f5f5;
      }

      .participants_user-join {
        background: #eaffea;
        color: #2e7d32;
        font-weight: bold;
      }

      #turn-info-panel {
        text-align: center;
        margin-top: 12px;
        display: none;
      }

      #timer-display {
        font-size: 2.5rem;
        font-weight: bold;
        color: var(--brand);
      }

      @media (max-width: 980px) {
        .room_container { grid-template-columns: 1fr; }
        .page_container { padding: 8px; }
      }
    </style>
</head>

<body>
<div class="page_container"
     th:data-user-no="${userNo}"
     th:data-room-no="${roomNo}"
     th:data-ws-url="${wsUrl}"
     th:data-access-token="${token}">

    <div class="page_header">
        <span>🎮 스무고개 게임방</span>
        <div class="user_info">
            <span sec:authentication="principal.username"></span>
            (<span sec:authorize="hasRole('TEACHER')">교사</span>
            <span sec:authorize="hasRole('STUDENT')">학생</span>)
        </div>
    </div>

    <div class="room_container">
        <!-- 왼쪽: 채팅 -->
        <div class="left_panel">
            <div class="board_area" id="board-area">
                <div class="system_message"></div>
            </div>

            <div class="teacher_controls" id="teacher-controls" sec:authorize="hasRole('TEACHER')">
                <div class="button_row">
                    <button class="big_button" id="teacher-o-btn" disabled>O</button>
                    <button class="big_button" id="teacher-x-btn" disabled>X</button>
                    <button class="big_button" id="teacher-end-btn" disabled>종료</button>
                    <button class="big_button" id="teacher-start-btn" disabled>시작</button>
                </div>
            </div>

            <div id="turn-info-panel">
                <h3><span id="turn-holder-name"></span>님의 차례</h3>
                <div id="timer-display">40</div>
            </div>

            <div class="student_controls" id="student-controls" sec:authorize="hasRole('STUDENT')">
                <div class="input_group">
                    <div class="input_label">질문</div>
                    <input class="text_input" id="question-input" placeholder="질문을 입력하세요" disabled/>
                    <button class="arrow_button" id="send-question" disabled>↗</button>
                </div>
                <div class="input_group">
                    <div class="input_label">정답</div>
                    <input class="text_input" id="answer-input" placeholder="정답을 입력하세요" disabled/>
                    <button class="arrow_button" id="send-answer" disabled>↗</button>
                </div>
                <button class="raise_button" id="raise-hand" disabled>✋ 손들기</button>
            </div>
        </div>

        <!-- 오른쪽: 참여자 목록 -->
        <aside class="participants_panel">
            <div class="participants_header">👥 참여자 명단</div>
            <div class="participants_list" id="participants-list">
                <div class="participants_user"
                     th:each="user : ${list}"
                     th:text="${user.nickName}"
                     th:data-user-no="${user.userNo}"
                     th:data-user-status="${user.status}">
                </div>
            </div>
        </aside>
    </div>
</div>

<th:block layout:fragment="script">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
    <script src="/js/modules/twenty/twentyGameRoom.js"></script>
</th:block>
</body>
</html>
